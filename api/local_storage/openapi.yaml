openapi: 3.0.3

info:
  title: CasaOS Local Storage API
  version: v2
  description: |-
    This API is used to manage local storage including disks, partitions and mounting points.

servers:
  - url: /v2/local_storage

tags:
  - name: Mount methods

  - name: Mount
    description: |-
      <SchemaDefinition schemaRef="#/components/schemas/Mount" />

x-tagGroups:
  - name: Mount
    tags:
      - Mount methods

  - name: Schemas
    tags:
      - Mount

paths:
  /mount:
    get:
      summary: Get all mounted volumes
      description: |-
        (TODO)
      operationId: getMounts
      tags:
        - Mount methods
      parameters:
        - name: id
          in: query
          description: |-
            Filter the results by id
          schema:
            type: string
            example: "0"
        - name: mount_point
          in: query
          description: |-
            Filter the results by mount point
          schema:
            type: string
            example: "/"
        - name: type
          in: query
          description: |-
            Filter the results by type
          schema:
            type: string
            example: "ext4"
        - name: source
          in: query
          description: |-
            Filter the results by source
          schema:
            type: string
            example: "/dev/sda1"
      responses:
        '200':
          $ref: '#/components/responses/GetMountsResponseOK'

    post:
      summary: Mount a volume
      description: |-
        (TODO)
      operationId: mount
      tags:
        - Mount methods
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MountRequest'
      responses:
        '200':
          $ref: '#/components/responses/MountResponseOK'
        '400':
          $ref: '#/components/responses/MountResponseBadRequest'

components:

  responses:

    GetMountsResponseOK:
      description: OK
      content:
        application/json:
          schema:
            allOf:
              - $ref: '#/components/schemas/BaseResponse'
              - type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Mount'

    MountResponseOK:
      description: OK
      content:
        application/json:
          schema:
            allOf:
              - $ref: '#/components/schemas/BaseResponse'
              - type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Mount'
    
    MountResponseBadRequest:
      description: Bad Request
      content:
        application/json:
          schema:
            allOf:
              - $ref: '#/components/schemas/BaseResponse'
          example:
            message: "Bad Request"

  schemas:

    BaseResponse:
      properties:
        message:
          readOnly: true
          description: message returned by server side if there is any
          type: string
          example: ""

    Mount:
      type: object
      properties:
        Id:
          type: integer
          readOnly: true
        Mountpoint:
          type: string
          example: "/media"
        FSType:
          type: string
          example: "mergerfs"
        Source:
          type: string
          example: "/mnt/a:/mnt/b"
        Options:
          type: string
          example: "defaults,allow_other,use_ino,category.create=mfs,moveonenospc=true,minfreespace=1M"

    MountRequest:
      type: object
      required:
        - Mount
      properties:
        Mount:
          $ref: '#/components/schemas/Mount'
        Persist:
          type: boolean
          default: true
